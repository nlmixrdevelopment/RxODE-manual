<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Easily creating RxODE events | RxODE user manual</title>
  <meta name="description" content="This book is the user manual for RxODE" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Easily creating RxODE events | RxODE user manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is the user manual for RxODE" />
  <meta name="github-repo" content="nlmixrdevelopment/RxODE-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Easily creating RxODE events | RxODE user manual" />
  
  <meta name="twitter:description" content="This book is the user manual for RxODE" />
  

<meta name="author" content="Matthew Fidler" />


<meta name="date" content="2021-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="events.html"/>
<link rel="next" href="solve.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

yes

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RxODE user manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="et" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Easily creating RxODE events</h1>
<p>An event table in RxODE is a specialized data frame that acts as a
container for all of RxODE’s events and observation times.</p>
<p>To create an RxODE event table you may use the code <code>eventTable()</code>,
<code>et()</code>, or even create your own data frame with the right event
information contained in it. This is closely related to the <a href="events.html#events">types of
events that RxODE supports</a>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="et.html#cb88-1" aria-hidden="true"></a><span class="kw">library</span>(RxODE)</span>
<span id="cb88-2"><a href="et.html#cb88-2" aria-hidden="true"></a>(ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>())</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 0 records ────────────────
#&gt; 
#&gt;    0 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)</code></pre>
<p>or</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="et.html#cb90-1" aria-hidden="true"></a>(ev &lt;-<span class="st"> </span><span class="kw">et</span>())</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 0 records ────────────────
#&gt; 
#&gt;    0 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)</code></pre>
<p>With this event table you can add sampling/observations or doses by
piping or direct access.</p>
<p>This is a short table of the two main functions to create dosing</p>
<table>
<thead>
<tr class="header">
<th>add.dosing()</th>
<th>et()</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dose</td>
<td>amt</td>
<td>Dose/Rate/Duration amount</td>
</tr>
<tr class="even">
<td>nbr.doses</td>
<td>addl</td>
<td>Additional doses or number of doses</td>
</tr>
<tr class="odd">
<td>dosing.interval</td>
<td>ii</td>
<td>Dosing Interval</td>
</tr>
<tr class="even">
<td>dosing.to</td>
<td>cmt</td>
<td>Dosing Compartment</td>
</tr>
<tr class="odd">
<td>rate</td>
<td>rate</td>
<td>Infusion rate</td>
</tr>
<tr class="even">
<td>start.time</td>
<td>time</td>
<td>Dosing start time</td>
</tr>
<tr class="odd">
<td></td>
<td>dur</td>
<td>Infusion Duration</td>
</tr>
</tbody>
</table>
<p>Sampling times can be added with <code>add.sampling(</code> sampling times <code>)</code> or
<code>et(</code> sampling times <code>)</code>. <a href="et.html#add-doses-and-samples-within-a-sampling-window">Dosing intervals and sampling
windows</a> are also
supported.</p>
<p>For these models, we can illustrate by using the model shared in the
RxODE tutorial:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="et.html#cb92-1" aria-hidden="true"></a><span class="co">## Model from RxODE tutorial</span></span>
<span id="cb92-2"><a href="et.html#cb92-2" aria-hidden="true"></a>m1 &lt;-<span class="kw">RxODE</span>({</span>
<span id="cb92-3"><a href="et.html#cb92-3" aria-hidden="true"></a>    KA=<span class="fl">2.94E-01</span>;</span>
<span id="cb92-4"><a href="et.html#cb92-4" aria-hidden="true"></a>    CL=<span class="fl">1.86E+01</span>;</span>
<span id="cb92-5"><a href="et.html#cb92-5" aria-hidden="true"></a>    V2=<span class="fl">4.02E+01</span>;</span>
<span id="cb92-6"><a href="et.html#cb92-6" aria-hidden="true"></a>    Q=<span class="fl">1.05E+01</span>;</span>
<span id="cb92-7"><a href="et.html#cb92-7" aria-hidden="true"></a>    V3=<span class="fl">2.97E+02</span>;</span>
<span id="cb92-8"><a href="et.html#cb92-8" aria-hidden="true"></a>    Kin=<span class="dv">1</span>;</span>
<span id="cb92-9"><a href="et.html#cb92-9" aria-hidden="true"></a>    Kout=<span class="dv">1</span>;</span>
<span id="cb92-10"><a href="et.html#cb92-10" aria-hidden="true"></a>    EC50=<span class="dv">200</span>;</span>
<span id="cb92-11"><a href="et.html#cb92-11" aria-hidden="true"></a>    <span class="co">## Added modeled bioavaiblity, duration and rate</span></span>
<span id="cb92-12"><a href="et.html#cb92-12" aria-hidden="true"></a>    fdepot =<span class="st"> </span><span class="dv">1</span>;</span>
<span id="cb92-13"><a href="et.html#cb92-13" aria-hidden="true"></a>    durDepot =<span class="st"> </span><span class="dv">8</span>;</span>
<span id="cb92-14"><a href="et.html#cb92-14" aria-hidden="true"></a>    rateDepot =<span class="st"> </span><span class="dv">1250</span>;</span>
<span id="cb92-15"><a href="et.html#cb92-15" aria-hidden="true"></a>    C2 =<span class="st"> </span>centr<span class="op">/</span>V2;</span>
<span id="cb92-16"><a href="et.html#cb92-16" aria-hidden="true"></a>    C3 =<span class="st"> </span>peri<span class="op">/</span>V3;</span>
<span id="cb92-17"><a href="et.html#cb92-17" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="op">-</span>KA<span class="op">*</span>depot;</span>
<span id="cb92-18"><a href="et.html#cb92-18" aria-hidden="true"></a>    <span class="kw">f</span>(depot) =<span class="st"> </span>fdepot</span>
<span id="cb92-19"><a href="et.html#cb92-19" aria-hidden="true"></a>    <span class="kw">dur</span>(depot) =<span class="st"> </span>durDepot</span>
<span id="cb92-20"><a href="et.html#cb92-20" aria-hidden="true"></a>    <span class="kw">rate</span>(depot) =<span class="st"> </span>rateDepot</span>
<span id="cb92-21"><a href="et.html#cb92-21" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3;</span>
<span id="cb92-22"><a href="et.html#cb92-22" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(peri)  =<span class="st">                    </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3;</span>
<span id="cb92-23"><a href="et.html#cb92-23" aria-hidden="true"></a>    d<span class="op">/</span><span class="kw">dt</span>(eff)  =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;</span>
<span id="cb92-24"><a href="et.html#cb92-24" aria-hidden="true"></a>    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb92-25"><a href="et.html#cb92-25" aria-hidden="true"></a>})</span></code></pre></div>
<div id="adding-doses-to-the-event-table" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Adding doses to the event table</h2>
<p>Once created you can add dosing to the event table by the
<code>add.dosing()</code>, and <code>et()</code> functions.</p>
<p>Using the <code>add.dosing()</code> function you have:</p>
<table>
<thead>
<tr class="header">
<th>argument</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dose</td>
<td>dose amount</td>
</tr>
<tr class="even">
<td>nbr.doses</td>
<td>Number of doses; Should be at least 1.</td>
</tr>
<tr class="odd">
<td>dosing.interval</td>
<td>Dosing interval; By default this is 24.</td>
</tr>
<tr class="even">
<td>dosing.to</td>
<td>Compartment where dose is administered.</td>
</tr>
<tr class="odd">
<td>rate</td>
<td>Infusion rate</td>
</tr>
<tr class="even">
<td>start.time</td>
<td>The start time of the dose</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="et.html#cb93-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hr&quot;</span>)</span>
<span id="cb93-2"><a href="et.html#cb93-2" aria-hidden="true"></a></span>
<span id="cb93-3"><a href="et.html#cb93-3" aria-hidden="true"></a><span class="co">## The methods ar attached to the event table, so you can use </span></span>
<span id="cb93-4"><a href="et.html#cb93-4" aria-hidden="true"></a><span class="co">## them directly</span></span>
<span id="cb93-5"><a href="et.html#cb93-5" aria-hidden="true"></a>ev<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses =</span> <span class="dv">3</span>)<span class="co"># loading doses</span></span>
<span id="cb93-6"><a href="et.html#cb93-6" aria-hidden="true"></a><span class="co">## Starts at time 0; Default dosing interval is 24</span></span>
<span id="cb93-7"><a href="et.html#cb93-7" aria-hidden="true"></a></span>
<span id="cb93-8"><a href="et.html#cb93-8" aria-hidden="true"></a><span class="co">## You can also pipe the event tables to these methods.</span></span>
<span id="cb93-9"><a href="et.html#cb93-9" aria-hidden="true"></a>ev &lt;-<span class="st"> </span>ev <span class="op">%&gt;%</span></span>
<span id="cb93-10"><a href="et.html#cb93-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">5000</span>, <span class="dt">nbr.doses=</span><span class="dv">14</span>,</span>
<span id="cb93-11"><a href="et.html#cb93-11" aria-hidden="true"></a>             <span class="dt">dosing.interval=</span><span class="dv">12</span>)<span class="co"># maintenance</span></span>
<span id="cb93-12"><a href="et.html#cb93-12" aria-hidden="true"></a></span>
<span id="cb93-13"><a href="et.html#cb93-13" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 2 records ────────────────
#&gt; 
#&gt;    2 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 2 x 5
#&gt;    time   amt    ii  addl evid        
#&gt;     [h]  [mg]   [h] &lt;int&gt; &lt;evid&gt;      
#&gt; 1     0 10000    24     2 1:Dose (Add)
#&gt; 2     0  5000    12    13 1:Dose (Add)</code></pre>
<p>Notice that the units were specified in the table. When specified, the
units use the <code>units</code> package to keep track of the units and convert
them if needed. Additionally, <code>ggforce</code> uses them to label the
<code>ggplot</code> axes. The <code>set_units</code> and <code>drop_units</code> are useful to set and
drop the RxODE event table units.</p>
<p>In this example, you can see the time axes is labeled:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="et.html#cb95-1" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, ev) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>If you are more familiar with the NONMEM/RxODE event records, you can
also specify dosing using <code>et</code> with the dose elements directly:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="et.html#cb96-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb96-2"><a href="et.html#cb96-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">3</span>, days),</span>
<span id="cb96-3"><a href="et.html#cb96-3" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="co"># loading doses</span></span>
<span id="cb96-4"><a href="et.html#cb96-4" aria-hidden="true"></a></span>
<span id="cb96-5"><a href="et.html#cb96-5" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 1 records ────────────────
#&gt; 
#&gt;    1 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 1 x 5
#&gt;    time   amt    ii  addl evid        
#&gt;     [h] &lt;dbl&gt;   [h] &lt;int&gt; &lt;evid&gt;      
#&gt; 1     0 10000    12     6 1:Dose (Add)</code></pre>
<p>Which gives:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="et.html#cb98-1" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, ev) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>This shows how easy creating event tables can be.</p>
</div>
<div id="adding-sampling-to-an-event-table" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Adding sampling to an event table</h2>
<p>If you notice in the above examples, RxODE generated some default
sampling times since there was not any sampling times. If you wish
more control over the sampling time, you should add the samples to the
RxODE event table by <code>add.sampling</code> or <code>et</code></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="et.html#cb99-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hr&quot;</span>)</span>
<span id="cb99-2"><a href="et.html#cb99-2" aria-hidden="true"></a></span>
<span id="cb99-3"><a href="et.html#cb99-3" aria-hidden="true"></a><span class="co">## The methods ar attached to the event table, so you can use them</span></span>
<span id="cb99-4"><a href="et.html#cb99-4" aria-hidden="true"></a><span class="co">## directly</span></span>
<span id="cb99-5"><a href="et.html#cb99-5" aria-hidden="true"></a>ev<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses =</span> <span class="dv">3</span>)<span class="co"># loading doses</span></span>
<span id="cb99-6"><a href="et.html#cb99-6" aria-hidden="true"></a></span>
<span id="cb99-7"><a href="et.html#cb99-7" aria-hidden="true"></a>ev<span class="op">$</span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dt">by=</span><span class="dv">4</span>))</span>
<span id="cb99-8"><a href="et.html#cb99-8" aria-hidden="true"></a></span>
<span id="cb99-9"><a href="et.html#cb99-9" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 8 records ────────────────
#&gt; 
#&gt;    1 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    7 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 8 x 5
#&gt;    time   amt    ii  addl evid         
#&gt;     [h]  [mg]   [h] &lt;int&gt; &lt;evid&gt;       
#&gt; 1     0    NA    NA    NA 0:Observation
#&gt; 2     0 10000    24     2 1:Dose (Add) 
#&gt; 3     4    NA    NA    NA 0:Observation
#&gt; 4     8    NA    NA    NA 0:Observation
#&gt; 5    12    NA    NA    NA 0:Observation
#&gt; 6    16    NA    NA    NA 0:Observation
#&gt; 7    20    NA    NA    NA 0:Observation
#&gt; 8    24    NA    NA    NA 0:Observation</code></pre>
<p>Which gives:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="et.html#cb101-1" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Or if you use <code>et</code> you can simply add them in a similar way to <code>add.sampling</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="et.html#cb102-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb102-2"><a href="et.html#cb102-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">3</span>, days),</span>
<span id="cb102-3"><a href="et.html#cb102-3" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># loading doses</span></span>
<span id="cb102-4"><a href="et.html#cb102-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dt">by=</span><span class="dv">4</span>))</span>
<span id="cb102-5"><a href="et.html#cb102-5" aria-hidden="true"></a></span>
<span id="cb102-6"><a href="et.html#cb102-6" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 8 records ────────────────
#&gt; 
#&gt;    1 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    7 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 8 x 5
#&gt;    time   amt    ii  addl evid         
#&gt;     [h] &lt;dbl&gt;   [h] &lt;int&gt; &lt;evid&gt;       
#&gt; 1     0    NA    NA    NA 0:Observation
#&gt; 2     0 10000    12     6 1:Dose (Add) 
#&gt; 3     4    NA    NA    NA 0:Observation
#&gt; 4     8    NA    NA    NA 0:Observation
#&gt; 5    12    NA    NA    NA 0:Observation
#&gt; 6    16    NA    NA    NA 0:Observation
#&gt; 7    20    NA    NA    NA 0:Observation
#&gt; 8    24    NA    NA    NA 0:Observation</code></pre>
<p>which gives the following RxODE solve:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="et.html#cb104-1" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>Note the jagged nature of these plots since there was only a few
sample times.</p>
</div>
<div id="expand-the-event-table-to-a-multi-subject-event-table." class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Expand the event table to a multi-subject event table.</h2>
<p>The only thing that is needed to expand an event table is a list of
IDs that you want to expand;</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="et.html#cb105-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb105-2"><a href="et.html#cb105-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">3</span>, days),</span>
<span id="cb105-3"><a href="et.html#cb105-3" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># loading doses</span></span>
<span id="cb105-4"><a href="et.html#cb105-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">200</span>)) <span class="op">%&gt;%</span></span>
<span id="cb105-5"><a href="et.html#cb105-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb105-6"><a href="et.html#cb105-6" aria-hidden="true"></a></span>
<span id="cb105-7"><a href="et.html#cb105-7" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ──────────────── EventTable with 804 records ───────────────
#&gt;    4 individuals
#&gt;    4 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    800 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 804 x 6
#&gt;       id      time   amt    ii  addl evid         
#&gt;    &lt;int&gt;       [h] &lt;dbl&gt;   [h] &lt;int&gt; &lt;evid&gt;       
#&gt;  1     1 0.0000000    NA    NA    NA 0:Observation
#&gt;  2     1 0.0000000 10000    12     6 1:Dose (Add) 
#&gt;  3     1 0.2412060    NA    NA    NA 0:Observation
#&gt;  4     1 0.4824121    NA    NA    NA 0:Observation
#&gt;  5     1 0.7236181    NA    NA    NA 0:Observation
#&gt;  6     1 0.9648241    NA    NA    NA 0:Observation
#&gt;  7     1 1.2060302    NA    NA    NA 0:Observation
#&gt;  8     1 1.4472362    NA    NA    NA 0:Observation
#&gt;  9     1 1.6884422    NA    NA    NA 0:Observation
#&gt; 10     1 1.9296482    NA    NA    NA 0:Observation
#&gt; # … with 794 more rows</code></pre>
<p>You can see in the following simulation there are 4 individuals that are solved for:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="et.html#cb107-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb107-2"><a href="et.html#cb107-2" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev,</span>
<span id="cb107-3"><a href="et.html#cb107-3" aria-hidden="true"></a>      <span class="dt">params=</span><span class="kw">data.frame</span>(<span class="dt">KA=</span><span class="fl">0.294</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)),</span>
<span id="cb107-4"><a href="et.html#cb107-4" aria-hidden="true"></a>                        <span class="fl">18.6</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb107-5"><a href="et.html#cb107-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<pre><code>#&gt; Warning: &#39;ID&#39; missing in &#39;parameters&#39; dataset
#&gt; individual parameters are assumed to have the same order as the event dataset</code></pre>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="add-doses-and-samples-within-a-sampling-window" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Add doses and samples within a sampling window</h2>
<p>In addition to adding fixed doses and fixed sampling times, you can
have windows where you sample and draw doses from. For dosing windows
you specify the time as an ordered numerical vector with the lowest
dosing time and the highest dosing time inside a list.</p>
<p>In this example, you start with a dosing time with a 6 hour dosing window:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="et.html#cb109-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb109-2"><a href="et.html#cb109-2" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb109-3"><a href="et.html#cb109-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>)), <span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">2</span>, days),</span>
<span id="cb109-4"><a href="et.html#cb109-4" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># loading doses</span></span>
<span id="cb109-5"><a href="et.html#cb109-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb109-6"><a href="et.html#cb109-6" aria-hidden="true"></a></span>
<span id="cb109-7"><a href="et.html#cb109-7" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ──────────────── EventTable with 16 records ────────────────
#&gt;    4 individuals
#&gt;    16 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 16 x 6
#&gt;       id   low       time  high   amt evid        
#&gt;    &lt;int&gt;   [h]        [h]   [h] &lt;dbl&gt; &lt;evid&gt;      
#&gt;  1     1     0  5.4888363     6 10000 1:Dose (Add)
#&gt;  2     1    12 16.9826858    18 10000 1:Dose (Add)
#&gt;  3     1    24 25.7168372    30 10000 1:Dose (Add)
#&gt;  4     1    36 41.6224525    42 10000 1:Dose (Add)
#&gt;  5     2     0  4.3146735     6 10000 1:Dose (Add)
#&gt;  6     2    12 14.7464507    18 10000 1:Dose (Add)
#&gt;  7     2    24 28.2303887    30 10000 1:Dose (Add)
#&gt;  8     2    36 39.9419537    42 10000 1:Dose (Add)
#&gt;  9     3     0  0.8079996     6 10000 1:Dose (Add)
#&gt; 10     3    12 16.4195299    18 10000 1:Dose (Add)
#&gt; 11     3    24 27.1145757    30 10000 1:Dose (Add)
#&gt; 12     3    36 39.8504731    42 10000 1:Dose (Add)
#&gt; 13     4     0  4.9826858     6 10000 1:Dose (Add)
#&gt; 14     4    12 13.7168372    18 10000 1:Dose (Add)
#&gt; 15     4    24 29.6224525    30 10000 1:Dose (Add)
#&gt; 16     4    36 41.4888363    42 10000 1:Dose (Add)</code></pre>
<p>You can clearly see different dosing times in the following simulation:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="et.html#cb111-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span>ev <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">200</span>))</span>
<span id="cb111-2"><a href="et.html#cb111-2" aria-hidden="true"></a></span>
<span id="cb111-3"><a href="et.html#cb111-3" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev,</span>
<span id="cb111-4"><a href="et.html#cb111-4" aria-hidden="true"></a>      <span class="dt">params=</span><span class="kw">data.frame</span>(<span class="dt">KA=</span><span class="fl">0.294</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)),</span>
<span id="cb111-5"><a href="et.html#cb111-5" aria-hidden="true"></a>                        <span class="fl">18.6</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb111-6"><a href="et.html#cb111-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<pre><code>#&gt; Warning: &#39;ID&#39; missing in &#39;parameters&#39; dataset
#&gt; individual parameters are assumed to have the same order as the event dataset</code></pre>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>Of course in reality the dosing interval may only be 2 hours:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="et.html#cb113-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb113-2"><a href="et.html#cb113-2" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-3"><a href="et.html#cb113-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">2</span>, days),</span>
<span id="cb113-4"><a href="et.html#cb113-4" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># loading doses</span></span>
<span id="cb113-5"><a href="et.html#cb113-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-6"><a href="et.html#cb113-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">200</span>))</span>
<span id="cb113-7"><a href="et.html#cb113-7" aria-hidden="true"></a></span>
<span id="cb113-8"><a href="et.html#cb113-8" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev,</span>
<span id="cb113-9"><a href="et.html#cb113-9" aria-hidden="true"></a>      <span class="dt">params=</span><span class="kw">data.frame</span>(<span class="dt">KA=</span><span class="fl">0.294</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)),</span>
<span id="cb113-10"><a href="et.html#cb113-10" aria-hidden="true"></a>                        <span class="fl">18.6</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb113-11"><a href="et.html#cb113-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<pre><code>#&gt; Warning: &#39;ID&#39; missing in &#39;parameters&#39; dataset
#&gt; individual parameters are assumed to have the same order as the event dataset</code></pre>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>The same sort of thing can be specified with sampling times. To
specify the sampling times in terms of a sampling window, you can
create a list of the sampling times. Each sampling time will be a two
element ordered numeric vector.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="et.html#cb115-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb115-2"><a href="et.html#cb115-2" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb115-3"><a href="et.html#cb115-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">time=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)), <span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">until =</span> <span class="kw">set_units</span>(<span class="dv">2</span>, days),</span>
<span id="cb115-4"><a href="et.html#cb115-4" aria-hidden="true"></a>     <span class="dt">ii=</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># loading doses</span></span>
<span id="cb115-5"><a href="et.html#cb115-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb115-6"><a href="et.html#cb115-6" aria-hidden="true"></a></span>
<span id="cb115-7"><a href="et.html#cb115-7" aria-hidden="true"></a><span class="co">## Create 20 samples in the first 24 hours and 20 samples in the</span></span>
<span id="cb115-8"><a href="et.html#cb115-8" aria-hidden="true"></a><span class="co">## second 24 hours</span></span>
<span id="cb115-9"><a href="et.html#cb115-9" aria-hidden="true"></a>samples &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="cf">function</span>(...){<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">24</span>)}),</span>
<span id="cb115-10"><a href="et.html#cb115-10" aria-hidden="true"></a>             <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="cf">function</span>(...){<span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">48</span>)}))</span>
<span id="cb115-11"><a href="et.html#cb115-11" aria-hidden="true"></a></span>
<span id="cb115-12"><a href="et.html#cb115-12" aria-hidden="true"></a><span class="co">## Add the random collection to the event table</span></span>
<span id="cb115-13"><a href="et.html#cb115-13" aria-hidden="true"></a>ev &lt;-<span class="st"> </span>ev <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">et</span>(samples)</span>
<span id="cb115-14"><a href="et.html#cb115-14" aria-hidden="true"></a></span>
<span id="cb115-15"><a href="et.html#cb115-15" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb115-16"><a href="et.html#cb115-16" aria-hidden="true"></a><span class="kw">solve</span>(m1, ev, <span class="dt">params=</span><span class="kw">data.frame</span>(<span class="dt">KA=</span><span class="fl">0.294</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)),</span>
<span id="cb115-17"><a href="et.html#cb115-17" aria-hidden="true"></a>                                <span class="fl">18.6</span><span class="op">*</span><span class="kw">exp</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>)))) <span class="op">%&gt;%</span></span>
<span id="cb115-18"><a href="et.html#cb115-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">plot</span>(C2) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>#&gt; Warning: &#39;ID&#39; missing in &#39;parameters&#39; dataset
#&gt; individual parameters are assumed to have the same order as the event dataset</code></pre>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>This shows the flexibility in dosing and sampling that the RxODE event tables allow.</p>
</div>
<div id="combining-event-tables" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Combining event tables</h2>
<p>Since you can create dosing records and sampling records, you can
create any complex dosing regimen you wish. In addition, RxODE allows
you to combine event tables by <code>c</code>, <code>seq</code>, <code>rep</code>, and <code>rbind</code>.</p>
</div>
<div id="sequencing-event-tables" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Sequencing event tables</h2>
<p>One way to combine event table is to sequence them by <code>c</code>, <code>seq</code> or
<code>etSeq</code>. This takes the two dosing groups and adds at least one
inter-dose interval between them:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="et.html#cb117-1" aria-hidden="true"></a><span class="co">## bid for 5 days</span></span>
<span id="cb117-2"><a href="et.html#cb117-2" aria-hidden="true"></a>bid &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb117-3"><a href="et.html#cb117-3" aria-hidden="true"></a><span class="st">       </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>,<span class="dt">ii=</span><span class="dv">12</span>,<span class="dt">until=</span><span class="kw">set_units</span>(<span class="dv">5</span>, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb117-4"><a href="et.html#cb117-4" aria-hidden="true"></a></span>
<span id="cb117-5"><a href="et.html#cb117-5" aria-hidden="true"></a><span class="co">## qd for 5 days</span></span>
<span id="cb117-6"><a href="et.html#cb117-6" aria-hidden="true"></a>qd &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb117-7"><a href="et.html#cb117-7" aria-hidden="true"></a><span class="st">      </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">20000</span>,<span class="dt">ii=</span><span class="dv">24</span>,<span class="dt">until=</span><span class="kw">set_units</span>(<span class="dv">5</span>, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb117-8"><a href="et.html#cb117-8" aria-hidden="true"></a></span>
<span id="cb117-9"><a href="et.html#cb117-9" aria-hidden="true"></a><span class="co">## bid for 5 days followed by qd for 5 days</span></span>
<span id="cb117-10"><a href="et.html#cb117-10" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">seq</span>(bid,qd) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">11</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">100</span>));</span>
<span id="cb117-11"><a href="et.html#cb117-11" aria-hidden="true"></a></span>
<span id="cb117-12"><a href="et.html#cb117-12" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>When sequencing events, you can also separate this sequence by a
period of time; For example if you wanted to separate this by a week,
you could easily do that with the following sequence of event tables:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="et.html#cb118-1" aria-hidden="true"></a><span class="co">## bid for 5 days followed by qd for 5 days</span></span>
<span id="cb118-2"><a href="et.html#cb118-2" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">seq</span>(bid,<span class="kw">set_units</span>(<span class="dv">1</span>, <span class="st">&quot;week&quot;</span>), qd) <span class="op">%&gt;%</span></span>
<span id="cb118-3"><a href="et.html#cb118-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">18</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">100</span>));</span>
<span id="cb118-4"><a href="et.html#cb118-4" aria-hidden="true"></a></span>
<span id="cb118-5"><a href="et.html#cb118-5" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>Note that in this example the time between the bid and the qd event
tables is exactly one week, not 1 week plus 24 hours because of the
inter-dose interval. If you want that behavior, you can sequence it
using the <code>wait="+ii"</code>.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="et.html#cb119-1" aria-hidden="true"></a><span class="co">## bid for 5 days followed by qd for 5 days</span></span>
<span id="cb119-2"><a href="et.html#cb119-2" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">seq</span>(bid,<span class="kw">set_units</span>(<span class="dv">1</span>, <span class="st">&quot;week&quot;</span>), qd,<span class="dt">wait=</span><span class="st">&quot;+ii&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb119-3"><a href="et.html#cb119-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">18</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">100</span>));</span>
<span id="cb119-4"><a href="et.html#cb119-4" aria-hidden="true"></a></span>
<span id="cb119-5"><a href="et.html#cb119-5" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Also note, that RxODE assumes that the dosing is what you want to
space the event tables by, and clears out any sampling records when
you combine the event tables. If that is not true, you can also use
the option <code>samples="use"</code></p>
</div>
<div id="repeating-event-tables" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Repeating event tables</h2>
<p>You can have an event table that you can repeat with <code>etRep</code> or <code>rep</code>.
For example 4 rounds of 2 weeks on QD therapy and 1 week off of
therapy can be simply specified:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="et.html#cb120-1" aria-hidden="true"></a>qd &lt;-<span class="kw">et</span>(<span class="dt">timeUnits =</span> <span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb120-2"><a href="et.html#cb120-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>, <span class="dt">ii=</span><span class="dv">24</span>, <span class="dt">until=</span><span class="kw">set_units</span>(<span class="dv">2</span>, <span class="st">&quot;weeks&quot;</span>), <span class="dt">cmt=</span><span class="st">&quot;depot&quot;</span>)</span>
<span id="cb120-3"><a href="et.html#cb120-3" aria-hidden="true"></a></span>
<span id="cb120-4"><a href="et.html#cb120-4" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">rep</span>(qd, <span class="dt">times=</span><span class="dv">4</span>, <span class="dt">wait=</span><span class="kw">set_units</span>(<span class="dv">1</span>,<span class="st">&quot;weeks&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb120-5"><a href="et.html#cb120-5" aria-hidden="true"></a><span class="st">      </span><span class="kw">add.sampling</span>(<span class="kw">set_units</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">12.5</span>,<span class="dt">by=</span><span class="fl">0.005</span>),weeks))</span>
<span id="cb120-6"><a href="et.html#cb120-6" aria-hidden="true"></a></span>
<span id="cb120-7"><a href="et.html#cb120-7" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>This is a simplified way to use a sequence of event tables.
Therefore, many of the same options still apply; That is <code>samples</code> are
cleared unless you use <code>samples="use"</code>, and the time between event
tables is at least the inter-dose interval. You can adjust the timing
by the <code>wait</code> option.</p>
</div>
<div id="combining-event-tables-with-rbind" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Combining event tables with rbind</h2>
<p>You may combine event tables with <code>rbind</code>. This does not consider the
event times when combining the event tables, but keeps them the same
times. If you space the event tables by a waiting period, it also does
not consider the inter-dose interval.</p>
<p>Using the previous <code>seq</code> you can clearly see the difference. Here was the sequence:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="et.html#cb121-1" aria-hidden="true"></a><span class="co">## bid for 5 days</span></span>
<span id="cb121-2"><a href="et.html#cb121-2" aria-hidden="true"></a>bid &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb121-3"><a href="et.html#cb121-3" aria-hidden="true"></a><span class="st">       </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">10000</span>,<span class="dt">ii=</span><span class="dv">12</span>,<span class="dt">until=</span><span class="kw">set_units</span>(<span class="dv">5</span>, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb121-4"><a href="et.html#cb121-4" aria-hidden="true"></a></span>
<span id="cb121-5"><a href="et.html#cb121-5" aria-hidden="true"></a><span class="co">## qd for 5 days</span></span>
<span id="cb121-6"><a href="et.html#cb121-6" aria-hidden="true"></a>qd &lt;-<span class="st"> </span><span class="kw">et</span>(<span class="dt">timeUnits=</span><span class="st">&quot;hr&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb121-7"><a href="et.html#cb121-7" aria-hidden="true"></a><span class="st">      </span><span class="kw">et</span>(<span class="dt">amt=</span><span class="dv">20000</span>,<span class="dt">ii=</span><span class="dv">24</span>,<span class="dt">until=</span><span class="kw">set_units</span>(<span class="dv">5</span>, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb121-8"><a href="et.html#cb121-8" aria-hidden="true"></a></span>
<span id="cb121-9"><a href="et.html#cb121-9" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">seq</span>(bid,qd) <span class="op">%&gt;%</span></span>
<span id="cb121-10"><a href="et.html#cb121-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">18</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">500</span>));</span>
<span id="cb121-11"><a href="et.html#cb121-11" aria-hidden="true"></a></span>
<span id="cb121-12"><a href="et.html#cb121-12" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>But if you bind them together with <code>rbind</code></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="et.html#cb122-1" aria-hidden="true"></a><span class="co">## bid for 5 days</span></span>
<span id="cb122-2"><a href="et.html#cb122-2" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">rbind</span>(bid,qd) <span class="op">%&gt;%</span></span>
<span id="cb122-3"><a href="et.html#cb122-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">18</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">500</span>));</span>
<span id="cb122-4"><a href="et.html#cb122-4" aria-hidden="true"></a></span>
<span id="cb122-5"><a href="et.html#cb122-5" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>Still the waiting period applies (but does not consider the inter-dose interval)</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="et.html#cb123-1" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">rbind</span>(bid,<span class="dt">wait=</span><span class="kw">set_units</span>(<span class="dv">10</span>,days),qd) <span class="op">%&gt;%</span></span>
<span id="cb123-2"><a href="et.html#cb123-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">18</span><span class="op">*</span><span class="dv">24</span>,<span class="dt">length.out=</span><span class="dv">500</span>));</span>
<span id="cb123-3"><a href="et.html#cb123-3" aria-hidden="true"></a></span>
<span id="cb123-4"><a href="et.html#cb123-4" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>You can also bind the tables together and make each ID in the event
table unique; This can be good to combine cohorts with different
expected dosing and sampling times. This requires the <code>id="unique"</code>
option; Using the first example shows how this is different in this case:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="et.html#cb124-1" aria-hidden="true"></a><span class="co">## bid for 5 days</span></span>
<span id="cb124-2"><a href="et.html#cb124-2" aria-hidden="true"></a>et &lt;-<span class="st"> </span><span class="kw">etRbind</span>(bid,qd, <span class="dt">id=</span><span class="st">&quot;unique&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb124-3"><a href="et.html#cb124-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">et</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">150</span>,<span class="dt">length.out=</span><span class="dv">500</span>));</span>
<span id="cb124-4"><a href="et.html#cb124-4" aria-hidden="true"></a></span>
<span id="cb124-5"><a href="et.html#cb124-5" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb124-6"><a href="et.html#cb124-6" aria-hidden="true"></a><span class="kw">rxSolve</span>(m1, et) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>(C2) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>id)</span></code></pre></div>
<p><img src="RxODE-manual_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
</div>
<div id="expanding-events" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Expanding events</h2>
<p>Event tables can be expanded so they contain an <code>addl</code> data item, like
the following example:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="et.html#cb125-1" aria-hidden="true"></a>ev &lt;-<span class="st"> </span><span class="kw">et</span>() <span class="op">%&gt;%</span></span>
<span id="cb125-2"><a href="et.html#cb125-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">et</span>(<span class="dt">dose=</span><span class="dv">50</span>, <span class="dt">ii=</span><span class="dv">8</span>, <span class="dt">until=</span><span class="dv">48</span>)</span>
<span id="cb125-3"><a href="et.html#cb125-3" aria-hidden="true"></a></span>
<span id="cb125-4"><a href="et.html#cb125-4" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 1 records ────────────────
#&gt; 
#&gt;    1 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with x$expand(); or etExpand(x)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 1 x 5
#&gt;    time   amt    ii  addl evid        
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;evid&gt;      
#&gt; 1     0    50     8     6 1:Dose (Add)</code></pre>
<p>You can expand the events so they do not have the <code>addl</code> items by
<code>$expand()</code> or <code>etExpand(ev)</code>:</p>
<p>The first, <code>etExpand(ev)</code> expands the event table without modifying the original data frame:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="et.html#cb127-1" aria-hidden="true"></a><span class="kw">etExpand</span>(ev)</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 7 records ────────────────
#&gt; 
#&gt;    7 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 7 x 4
#&gt;    time   amt    ii evid        
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;evid&gt;      
#&gt; 1     0    50     0 1:Dose (Add)
#&gt; 2     8    50     0 1:Dose (Add)
#&gt; 3    16    50     0 1:Dose (Add)
#&gt; 4    24    50     0 1:Dose (Add)
#&gt; 5    32    50     0 1:Dose (Add)
#&gt; 6    40    50     0 1:Dose (Add)
#&gt; 7    48    50     0 1:Dose (Add)</code></pre>
<p>You can see the <code>addl</code> events were expanded, however the original data
frame remained intact:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="et.html#cb129-1" aria-hidden="true"></a><span class="kw">print</span>(ev)</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 1 records ────────────────
#&gt; 
#&gt;    1 dosing records (see $get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see $get.sampling(); add with add.sampling or et)
#&gt;    multiple doses in `addl` columns, expand with $expand(); or etExpand()
#&gt; ── First part of : ─────────────────────────────────────────
#&gt; # A tibble: 1 x 5
#&gt;    time   amt    ii  addl evid        
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;evid&gt;      
#&gt; 1     0    50     8     6 1:Dose (Add)</code></pre>
<p>If you use <code>ev$expand()</code> it will modify the <code>ev</code> object. This is
similar to an object-oriented method:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="et.html#cb131-1" aria-hidden="true"></a>ev<span class="op">$</span><span class="kw">expand</span>()</span>
<span id="cb131-2"><a href="et.html#cb131-2" aria-hidden="true"></a>ev</span></code></pre></div>
<pre><code>#&gt; ───────────────── EventTable with 7 records ────────────────
#&gt; 
#&gt;    7 dosing records (see x$get.dosing(); add with add.dosing or et)
#&gt;    0 observation times (see x$get.sampling(); add with add.sampling or et)
#&gt; ── First part of x: ────────────────────────────────────────
#&gt; # A tibble: 7 x 4
#&gt;    time   amt    ii evid        
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;evid&gt;      
#&gt; 1     0    50     0 1:Dose (Add)
#&gt; 2     8    50     0 1:Dose (Add)
#&gt; 3    16    50     0 1:Dose (Add)
#&gt; 4    24    50     0 1:Dose (Add)
#&gt; 5    32    50     0 1:Dose (Add)
#&gt; 6    40    50     0 1:Dose (Add)
#&gt; 7    48    50     0 1:Dose (Add)</code></pre>
</div>
<div id="event-tables-in-rstudio-notebooks" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> Event tables in Rstudio Notebooks</h2>
<p>In addition to the output in the console which has been shown in the above examples, Rstudio notebook output is different and can be seen in the following screenshots;</p>
<p>The first screenshot shows how the event table looks after evaluating
it in the Rstduio notebook</p>
<p><img src="eventTable-output-notebook-02.png" /></p>
<p>This is a simple dataframe that allows you to page through the
contents. If you click on the first box in the Rstudio notebook
output, it will have the notes about the event table:</p>
<p><img src="eventTable-output-notebook-01.png" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="events.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="solve.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["RxODE-manual.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
